{"version":3,"sources":["../../../lib/doc/range.js"],"names":["colCache","require","module","exports","decode","arguments","t","l","b","r","s","length","tl","decodeAddress","br","model","top","Math","min","row","left","col","bottom","max","right","sheetName","setTLBR","argv","value","Range","Array","tlbr","decodeEx","Error","dimensions","number","expand","addressStr","address","range","other","containsEx","test","n2l","_serialisedSheetName","$t$l","$b$r","count","$range"],"mappings":"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","sourcesContent":["'use strict';\n\nconst colCache = require('./../utils/col-cache');\n\n// used by worksheet to calculate sheet dimensions\nmodule.exports = class Range {\n  constructor() {\n    this.decode(arguments);\n  }\n\n  setTLBR(t, l, b, r, s) {\n    if (arguments.length < 4) {\n      // setTLBR(tl, br, s)\n      const tl = colCache.decodeAddress(t);\n      const br = colCache.decodeAddress(l);\n      this.model = {\n        top: Math.min(tl.row, br.row),\n        left: Math.min(tl.col, br.col),\n        bottom: Math.max(tl.row, br.row),\n        right: Math.max(tl.col, br.col),\n        sheetName: b,\n      };\n\n      this.setTLBR(tl.row, tl.col, br.row, br.col, s);\n    } else {\n      // setTLBR(t, l, b, r, s)\n      this.model = {\n        top: Math.min(t, b),\n        left: Math.min(l, r),\n        bottom: Math.max(t, b),\n        right: Math.max(l, r),\n        sheetName: s,\n      };\n    }\n  }\n\n  decode(argv) {\n    switch (argv.length) {\n      case 5: // [t,l,b,r,s]\n        this.setTLBR(argv[0], argv[1], argv[2], argv[3], argv[4]);\n        break;\n      case 4: // [t,l,b,r]\n        this.setTLBR(argv[0], argv[1], argv[2], argv[3]);\n        break;\n\n      case 3: // [tl,br,s]\n        this.setTLBR(argv[0], argv[1], argv[2]);\n        break;\n      case 2: // [tl,br]\n        this.setTLBR(argv[0], argv[1]);\n        break;\n\n      case 1: {\n        const value = argv[0];\n        if (value instanceof Range) {\n          // copy constructor\n          this.model = {\n            top: value.model.top,\n            left: value.model.left,\n            bottom: value.model.bottom,\n            right: value.model.right,\n            sheetName: value.sheetName,\n          };\n        } else if (value instanceof Array) {\n          // an arguments array\n          this.decode(value);\n        } else if (value.top && value.left && value.bottom && value.right) {\n          // a model\n          this.model = {\n            top: value.top,\n            left: value.left,\n            bottom: value.bottom,\n            right: value.right,\n            sheetName: value.sheetName,\n          };\n        } else {\n          // [sheetName!]tl:br\n          const tlbr = colCache.decodeEx(value);\n          if (tlbr.top) {\n            this.model = {\n              top: tlbr.top,\n              left: tlbr.left,\n              bottom: tlbr.bottom,\n              right: tlbr.right,\n              sheetName: tlbr.sheetName,\n            };\n          } else {\n            this.model = {\n              top: tlbr.row,\n              left: tlbr.col,\n              bottom: tlbr.row,\n              right: tlbr.col,\n              sheetName: tlbr.sheetName,\n            };\n          }\n        }\n        break;\n      }\n\n      case 0:\n        this.model = {\n          top: 0,\n          left: 0,\n          bottom: 0,\n          right: 0,\n        };\n        break;\n\n      default:\n        throw new Error(`Invalid number of arguments to _getDimensions() - ${argv.length}`);\n    }\n  }\n\n  get top() {\n    return this.model.top || 1;\n  }\n\n  set top(value) {\n    this.model.top = value;\n  }\n\n  get left() {\n    return this.model.left || 1;\n  }\n\n  set left(value) {\n    this.model.left = value;\n  }\n\n  get bottom() {\n    return this.model.bottom || 1;\n  }\n\n  set bottom(value) {\n    this.model.bottom = value;\n  }\n\n  get right() {\n    return this.model.right || 1;\n  }\n\n  set right(value) {\n    this.model.right = value;\n  }\n\n  get sheetName() {\n    return this.model.sheetName;\n  }\n\n  set sheetName(value) {\n    this.model.sheetName = value;\n  }\n\n  get _serialisedSheetName() {\n    const { sheetName } = this.model;\n    if (sheetName) {\n      if (/^[a-zA-Z0-9]*$/.test(sheetName)) {\n        return `${sheetName}!`;\n      }\n      return `'${sheetName}'!`;\n    }\n    return '';\n  }\n\n  expand(top, left, bottom, right) {\n    if (!this.model.top || top < this.top) this.top = top;\n    if (!this.model.left || left < this.left) this.left = left;\n    if (!this.model.bottom || bottom > this.bottom) this.bottom = bottom;\n    if (!this.model.right || right > this.right) this.right = right;\n  }\n\n  expandRow(row) {\n    if (row) {\n      const { dimensions, number } = row;\n      if (dimensions) {\n        this.expand(number, dimensions.min, number, dimensions.max);\n      }\n    }\n  }\n\n  expandToAddress(addressStr) {\n    const address = colCache.decodeEx(addressStr);\n    this.expand(address.row, address.col, address.row, address.col);\n  }\n\n  get tl() {\n    return colCache.n2l(this.left) + this.top;\n  }\n\n  get $t$l() {\n    return `$${colCache.n2l(this.left)}$${this.top}`;\n  }\n\n  get br() {\n    return colCache.n2l(this.right) + this.bottom;\n  }\n\n  get $b$r() {\n    return `$${colCache.n2l(this.right)}$${this.bottom}`;\n  }\n\n  get range() {\n    return `${this._serialisedSheetName + this.tl}:${this.br}`;\n  }\n\n  get $range() {\n    return `${this._serialisedSheetName + this.$t$l}:${this.$b$r}`;\n  }\n\n  get shortRange() {\n    return this.count > 1 ? this.range : this._serialisedSheetName + this.tl;\n  }\n\n  get $shortRange() {\n    return this.count > 1 ? this.$range : this._serialisedSheetName + this.$t$l;\n  }\n\n  get count() {\n    return (1 + this.bottom - this.top) * (1 + this.right - this.left);\n  }\n\n  toString() {\n    return this.range;\n  }\n\n  intersects(other) {\n    if (other.sheetName && this.sheetName && other.sheetName !== this.sheetName) return false;\n    if (other.bottom < this.top) return false;\n    if (other.top > this.bottom) return false;\n    if (other.right < this.left) return false;\n    if (other.left > this.right) return false;\n    return true;\n  }\n\n  contains(addressStr) {\n    const address = colCache.decodeEx(addressStr);\n    return this.containsEx(address);\n  }\n\n  containsEx(address) {\n    if (address.sheetName && this.sheetName && address.sheetName !== this.sheetName) return false;\n    return address.row >= this.top && address.row <= this.bottom && address.col >= this.left && address.col <= this.right;\n  }\n};\n"],"file":"range.js"}