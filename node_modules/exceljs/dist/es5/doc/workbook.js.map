{"version":3,"sources":["../../../lib/doc/workbook.js"],"names":["Worksheet","require","DefinedNames","XLSX","CSV","Workbook","created","Date","modified","properties","_worksheets","views","media","_definedNames","name","options","id","nextId","console","trace","tabColor","argb","theme","indexed","lastOrderNo","reduce","acc","ws","orderNo","worksheetOptions","Object","assign","workbook","worksheet","getWorksheet","destroy","undefined","find","Boolean","iteratee","worksheets","forEach","sheet","_themes","image","length","push","type","_xlsx","_csv","i","slice","sort","a","b","filter","creator","lastModifiedBy","lastPrinted","map","model","sheets","definedNames","company","manager","title","subject","keywords","category","description","language","revision","contentStatus","themes","value","worksheetModel","state","findIndex","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nconst Worksheet = require('./worksheet');\nconst DefinedNames = require('./defined-names');\nconst XLSX = require('./../xlsx/xlsx');\nconst CSV = require('./../csv/csv');\n\n// Workbook requirements\n//  Load and Save from file and stream\n//  Access/Add/Delete individual worksheets\n//  Manage String table, Hyperlink table, etc.\n//  Manage scaffolding for contained objects to write to/read from\n\nclass Workbook {\n  constructor() {\n    this.created = new Date();\n    this.modified = this.created;\n    this.properties = {};\n    this._worksheets = [];\n    this.views = [];\n    this.media = [];\n    this._definedNames = new DefinedNames();\n  }\n\n  get xlsx() {\n    if (!this._xlsx) this._xlsx = new XLSX(this);\n    return this._xlsx;\n  }\n\n  get csv() {\n    if (!this._csv) this._csv = new CSV(this);\n    return this._csv;\n  }\n\n  get nextId() {\n    // find the next unique spot to add worksheet\n    for (let i = 1; i < this._worksheets.length; i++) {\n      if (!this._worksheets[i]) {\n        return i;\n      }\n    }\n    return this._worksheets.length || 1;\n  }\n\n  addWorksheet(name, options) {\n    const id = this.nextId;\n    name = name || `sheet${id}`;\n\n    // if options is a color, call it tabColor (and signal deprecated message)\n    if (options) {\n      if (typeof options === 'string') {\n        // eslint-disable-next-line no-console\n        console.trace('tabColor argument is now deprecated. Please use workbook.addWorksheet(name, {properties: { tabColor: { argb: \"rbg value\" } }');\n        options = {\n          properties: {\n            tabColor: { argb: options },\n          },\n        };\n      } else if (options.argb || options.theme || options.indexed) {\n        // eslint-disable-next-line no-console\n        console.trace('tabColor argument is now deprecated. Please use workbook.addWorksheet(name, {properties: { tabColor: { ... } }');\n        options = {\n          properties: {\n            tabColor: options,\n          },\n        };\n      }\n    }\n\n    const lastOrderNo = this._worksheets.reduce((acc, ws) => ((ws && ws.orderNo) > acc ? ws.orderNo : acc), 0);\n    const worksheetOptions = Object.assign({}, options, {\n      id,\n      name,\n      orderNo: lastOrderNo + 1,\n      workbook: this,\n    });\n\n    const worksheet = new Worksheet(worksheetOptions);\n\n    this._worksheets[id] = worksheet;\n    return worksheet;\n  }\n\n  removeWorksheetEx(worksheet) {\n    delete this._worksheets[worksheet.id];\n  }\n\n  removeWorksheet(id) {\n    const worksheet = this.getWorksheet(id);\n    if (worksheet) {\n      worksheet.destroy();\n    }\n  }\n\n  getWorksheet(id) {\n    if (id === undefined) {\n      return this._worksheets.find(Boolean);\n    }\n    if (typeof id === 'number') {\n      return this._worksheets[id];\n    }\n    if (typeof id === 'string') {\n      return this._worksheets.find(worksheet => worksheet && worksheet.name === id);\n    }\n    return undefined;\n  }\n\n  get worksheets() {\n    // return a clone of _worksheets\n    return this._worksheets\n      .slice(1)\n      .sort((a, b) => a.orderNo - b.orderNo)\n      .filter(Boolean);\n  }\n\n  eachSheet(iteratee) {\n    this.worksheets.forEach(sheet => {\n      iteratee(sheet, sheet.id);\n    });\n  }\n\n  get definedNames() {\n    return this._definedNames;\n  }\n\n  clearThemes() {\n    // Note: themes are not an exposed feature, meddle at your peril!\n    this._themes = undefined;\n  }\n\n  addImage(image) {\n    // TODO:  validation?\n    const id = this.media.length;\n    this.media.push(Object.assign({}, image, { type: 'image' }));\n    return id;\n  }\n\n  getImage(id) {\n    return this.media[id];\n  }\n\n  get model() {\n    return {\n      creator: this.creator || 'Unknown',\n      lastModifiedBy: this.lastModifiedBy || 'Unknown',\n      lastPrinted: this.lastPrinted,\n      created: this.created,\n      modified: this.modified,\n      properties: this.properties,\n      worksheets: this.worksheets.map(worksheet => worksheet.model),\n      sheets: this.worksheets.map(ws => ws.model).filter(Boolean),\n      definedNames: this._definedNames.model,\n      views: this.views,\n      company: this.company,\n      manager: this.manager,\n      title: this.title,\n      subject: this.subject,\n      keywords: this.keywords,\n      category: this.category,\n      description: this.description,\n      language: this.language,\n      revision: this.revision,\n      contentStatus: this.contentStatus,\n      themes: this._themes,\n      media: this.media,\n    };\n  }\n\n  set model(value) {\n    this.creator = value.creator;\n    this.lastModifiedBy = value.lastModifiedBy;\n    this.lastPrinted = value.lastPrinted;\n    this.created = value.created;\n    this.modified = value.modified;\n    this.company = value.company;\n    this.manager = value.manager;\n    this.title = value.title;\n    this.subject = value.subject;\n    this.keywords = value.keywords;\n    this.category = value.category;\n    this.description = value.description;\n    this.language = value.language;\n    this.revision = value.revision;\n    this.contentStatus = value.contentStatus;\n\n    this.properties = value.properties;\n    this._worksheets = [];\n    value.worksheets.forEach(worksheetModel => {\n      const { id, name, state } = worksheetModel;\n      const orderNo = value.sheets && value.sheets.findIndex(ws => ws.id === id);\n      const worksheet = (this._worksheets[id] = new Worksheet({\n        id,\n        name,\n        orderNo,\n        state,\n        workbook: this,\n      }));\n\n      worksheet.model = worksheetModel;\n    });\n\n    this._definedNames.model = value.definedNames;\n    this.views = value.views;\n    this._themes = value.themes;\n    this.media = value.media || [];\n  }\n}\n\nmodule.exports = Workbook;\n"],"file":"workbook.js"}